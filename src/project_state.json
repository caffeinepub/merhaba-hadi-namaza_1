{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Android-Web entegrasyonunda web tarafının ürettiği JSON’un Android PersistentNotificationService tarafından doğru parse edilmesi, SharedPreferences’a kaydedilmesi ve servisin periyodik olarak bildirimi güncellemesi hedefleniyor. Mevcut sorun: web düz string gönderiyor, Android JSONObject/JSONArray beklediği için çöküyor.",
  "architectural_notes": [
    "Android tarafı JSON şeması: root JSON içinde dailyPrayers ve weeklyPrayers alanları bulunur; her biri JSONArray olup elemanları {\"name\":string,\"time\":string,\"timeMillis\":number} formatında JSONObject olmalıdır.",
    "Web -> Android veri aktarımı WebView JS bridge üzerinden tek bir JSON string ile yapılır: window.AndroidPush.sendPrayerTimes(JSON.stringify(jsonData)).",
    "Android, son alınan JSON’u SharedPreferences’ta saklayıp Foreground Service içinde okuyarak bildirimi günceller; WebView kapalıyken web tarafı veri gönderemez."
  ],
  "known_issues": [
    "Web tarafı dailyPrayers/weeklyPrayers içinde düz string gönderdiğinde Android JSONObject/JSONArray beklediği için parse sırasında çökme yaşanıyor.",
    "Bildirim geri sayımı yalnızca uygulama açılınca güncelleniyor; arka planda periyodik güncelleme mekanizması yok."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-update-the-web-to-androidpush-payload-so-dailyprayers-and-weeklyprayers-are-json-arrays-of-objects-not-strings-where-each-element-is-exactly-name-string-time-string-timemillis-number-and-ensure-the-payload-is-sent-via-window-androidpush-sendprayertimes-json-stringify-jsondata-without-causing-android-side-jsonobject-jsonarray-parsing-crashes",
      "title": "Update the web-to-AndroidPush payload so `dailyPrayers` and `weeklyPrayers` are JSON arrays of objects (not strings), where each element is exactly `{ \"name\": string, \"time\": string, \"timeMillis\": number }`, and ensure the payload is sent via `window.AndroidPush.sendPrayerTimes(JSON.stringify(jsonData))` without causing Android-side `JSONObject`/`JSONArray` parsing crashes.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-androidpush-typescript-declarations-and-web-bridge-validation-to-match-the-new-schema-where-dailyprayers-and-weeklyprayers-are-arrays-of-objects-name-time-timemillis-not-formatted-strings-and-keep-backward-compatible-bridge-method-fallback-behavior-sendprayertimes-then-send",
      "title": "Update the AndroidPush TypeScript declarations and web bridge validation to match the new schema where `dailyPrayers` and `weeklyPrayers` are arrays of objects `{name,time,timeMillis}` (not formatted strings), and keep backward-compatible bridge method fallback behavior (`sendPrayerTimes` then `send`).",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-add-developer-facing-documentation-that-includes-1-an-example-javascript-snippet-that-builds-the-correct-jsondata-structure-including-daily-weekly-arrays-of-name-time-timemillis-and-calls-window-androidpush-sendprayertimes-json-stringify-jsondata-and-2-an-example-kotlin-snippet-showing-how-android-should-parse-the-json-jsonobject-jsonarray-jsonobject-store-retrieve-it-from-sharedpreferences-compute-the-next-upcoming-prayer-using-timemillis-and-periodically-refresh-a-persistent-notification-while-the-app-ui-is-not-open",
      "title": "Add developer-facing documentation that includes (1) an example JavaScript snippet that builds the correct `jsonData` structure (including daily + weekly arrays of `{name,time,timeMillis}`) and calls `window.AndroidPush.sendPrayerTimes(JSON.stringify(jsonData))`, and (2) an example Kotlin snippet showing how Android should parse the JSON (`JSONObject` -> `JSONArray` -> `JSONObject`), store/retrieve it from SharedPreferences, compute the next upcoming prayer using `timeMillis`, and periodically refresh a persistent notification while the app UI is not open.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Web tarafında dailyPrayers ve weeklyPrayers alanlarını her elemanı {name,time,timeMillis} olan JSON nesneleri (JSONArray of JSONObject) şeklinde üretip window.AndroidPush.sendPrayerTimes(JSON.stringify(jsonData)) ile göndermek",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Android tarafında gelen JSON string’ini SharedPreferences’a kaydetmek ve servis içinde okuyup parse etmek (dailyPrayers/weeklyPrayers -> JSONArray -> JSONObject)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "PersistentNotificationService içinde periyodik döngü/zamanlayıcı ile sıradaki vakti hesaplayıp bildirimi uygulama açık değilken de güncellemek",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Android tarafında JSON şema uyumsuzluğundan kaynaklı çökme durumunu önlemek için güvenli parse/validasyon ve hata toleransı eklemek",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Fix AndroidPush prayer-times payload schema (dailyPrayers/weeklyPrayers as JSON objects) and document Android parsing + periodic notification updates",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}